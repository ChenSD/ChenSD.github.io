---
layout: post
title:   如何从七牛云下载图片
date:   2019-03-11 22:10:20
categories: toolbox
---

18年七牛云的子域名功能取消了。新建一共存储空间之后，子域名只能保留30天，之后自动取消。

在这种情况下，想要从已经取消子域名的存储空间中下载图片，七牛工程师给的方法：

有两种方式来获取文件，需要备份的文件较多可以参考方案一，需要备份的文件较少可以参考方案二。

## 方案一（实测此方法只适合Linux系统）

您需要先新建一个同区域存储空间，会分配一个新的测试域名到新空间。

1）qshell account 此处填写ak 此处填写sk 此处填写自定义的用户名 （ak sk可以在控制台右上角的个人面板，密钥管理里找到）

2) qshell listbucket 原bucket名 -o list.txt （list出全部文件，https://github.com/qiniu/qshell/blob/master/docs/listbucket.md）

3）cat list.txt | awk '{print $1}' >list_final.txt （ 用awk获取list结果的第一列）

4）qshell batchcopy 原bucket名 新bucket名 -i list_final.txt （复制到新bucket的文件和原bucket文件名一致，https://github.com/qiniu/qshell/blob/master/docs/batchcopy.md）

5）qshell qdownload newfilelist.txt （newfilelist.txt为下载的配置文档，https://github.com/qiniu/qshell/blob/master/docs/qdownload.md）



qshell安装包及文档请参考https://developer.qiniu.com/kodo/tools/1302/qshell

windows环境下安装教程参考 https://developer.qiniu.com/kodo/kb/5545/windows-environment-installation-qshell-tutorial

## 方案一 Windows版本

1. 注意qshell命令无法直接调用，需要使用.\qshell_windows_x64.exe命令替代；
2. awk无法使用，需要下载awk，安装后把awk.exe放到qhell文件夹中才可以调用。
3. list_final.txt 需要为UTF-8编码格式。

## 方案二

使用工具qrsctl

https://developer.qiniu.com/kodo/tools/1300/qrsctl

qrsctl get <bucket> <file> <file>

## References
1. https://support.qiniu.com/tickets/145405
2. https://xyinzhe.com/2018/06/qnxz.html
